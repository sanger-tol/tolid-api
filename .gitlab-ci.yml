# SPDX-FileCopyrightText: 2021 Genome Research Ltd.
#
# SPDX-License-Identifier: MIT

include:
  - project: 'tol/tol-core'
    #ref: v1.3.1
    #file: '/gitlab/app.yml'

    ref: '29c7250083e5dc1f5da9d2cdb61c8d186d3ea792' # TODO change back!!!!
    file: '/gitlab/main.yml' # TODO change back!!!

variables:
  APP_NAME: "tolid"
  SERVICE_NAME: "id"
  ENABLE_ROBOT_REVIEW: "true"

  CI_COMMIT_SHA: "d93fff4b706254e862d9d4ad39844d3a58655d52" # TODO remove!!!!


# TODO remove everything below here!!!!....
stages:
  - lint
  - build
  - unit test
  - system test
  - review
  - integration test
  - cleanup
  - deploy

review_app:
  extends: .review_app
  rules:
    - if: $DISABLE_REVIEW_APPS
      when: never
    - if: $CI_COMMIT_BRANCH =~ /^TOLP-.*$/

test_robot:
  extends: .test-robot
  needs: ["review_app"]

stop_review:
  extends: .stop_review
  rules:
    - if: $DISABLE_REVIEW_APPS
      when: never
    - if: $CI_COMMIT_BRANCH =~ /^TOLP-.*$/
      when: manual
